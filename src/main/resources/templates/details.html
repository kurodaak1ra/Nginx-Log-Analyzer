<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="/analyzer/css/details.css">
  <title>Nginx Log Analyser - Details</title>
</head>
<body>
  <p class="main-title">Total Log: [[ ${count} ]]</p>

  <table>
    <thead>
      <tr>
        <th>#</th>
        <th title="RemoteAddr">RemoteAddr</th>
        <th title="HttpXForwardedFor">HttpXForwardedFor</th>
        <th title="TimeLocal">TimeLocal</th>
        <th title="Status">Status</th>
        <th title="Method">Method</th>
        <th title="Protocol">Protocol</th>
        <th title="SSLProtocol">SSLProtocol</th>
        <th title="SSLCipher">SSLCipher</th>
        <th title="UpstreamAddr">UpstreamAddr</th>
        <th title="UpstreamResponseTime">RespTime</th>
        <th title="BodyBytesSent">Bytes</th>
        <th title="RequestTime">ReqTime</th>
        <th title="RemoteUser">RemoteUser</th>
        <th title="URI">URI</th>
        <th title="HttpReferer">HttpReferer</th>
        <th title="HttpUserAgent">HttpUserAgent</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="loading">
    <div class="content">
      <div class="inner">
        <p>Loading. . .</p>
      </div>
    </div>
  </div>
</body>
<script src="/analyzer/js/common.js"></script>
<script th:inline="javascript">
  [[ ${list} ]].forEach((item, index) => {
    const tr = document.createElement("tr")
    tr.innerHTML = `
      <td>`+(index+1)+`</td>
      <td onclick="GET('`+item.remoteAddr+`')">`+item.remoteAddr+`</td>
      <td onclick="GET('`+item.httpXForwardedFor+`')">`+item.httpXForwardedFor+`</td>
      <td>`+item.timeLocal+`</td>
      <td>`+item.status+`</td>
      <td>`+item.method+`</td>
      <td>`+item.protocol+`</td>
      <td>`+item.sslprotocol+`</td>
      <td>`+item.sslcipher+`</td>
      <td>`+item.upstreamAddr+`</td>
      <td>`+item.upstreamResponseTime+`</td>
      <td>`+item.bodyBytesSent+`</td>
      <td>`+item.requestTime+`</td>
      <td>`+item.remoteUser+`</td>
      <td>`+item.uri+`</td>
      <td>`+item.httpReferer+`</td>
      <td>`+item.httpUserAgent+`</td>
    `
    tr.addEventListener('click', function() {
      tr.classList.toggle('active')
    })
    document.getElementById("tbody").append(tr)
  })

  const loading = document.getElementsByClassName('loading')
  loading[0].style.display = 'none'

  function GET(ip) {
    const api = [[ ${api} ]]
    if (api === '') return
    const http = new XMLHttpRequest();
    http.open('GET', api + ip)
    http.send()
    http.onreadystatechange = function() {
      if (this.readyState === 4 && this.status === 200) {
        const resp = JSON.parse(http.response)
        if (resp.code === 0) {
          console.log(resp.data)
        }
      }
    }
  }
</script>
</html>
